@model VolunteerManagment.Models.Event

@{
    ViewData["Title"] = "Event Details";
    var userRole = Context.Session.GetString("Role");
    var userId = int.Parse(Context.Session.GetString("UserId"));
    var isOrganizer = Model.CreatedBy == userId;
}

<h2>@Model.Title</h2>
<hr />

<dl class="row">
    <dt class="col-sm-3">Description</dt>
    <dd class="col-sm-9">@Model.Description</dd>

    <dt class="col-sm-3">Category</dt>
    <dd class="col-sm-9">@Model.Category</dd>

    <dt class="col-sm-3">Location</dt>
    <dd class="col-sm-9">@Model.Location</dd>

    <dt class="col-sm-3">Date</dt>
    <dd class="col-sm-9">@Model.Date.ToShortDateString()</dd>

    <dt class="col-sm-3">Status</dt>
    <dd class="col-sm-9">@Model.Status</dd>

    <dt class="col-sm-3">Organizer</dt>
    <dd class="col-sm-9">@Model.Organizer?.UserName (@Model.Organizer?.Email)</dd>
</dl>

@if (isOrganizer)
{
    <div class="mb-3">
        <a asp-action="Edit" asp-route-id="@Model.EventId" class="btn btn-warning">Edit</a>
        <a asp-action="Delete" asp-route-id="@Model.EventId" class="btn btn-danger">Delete</a>
        <a asp-action="Index" class="btn btn-secondary">Back to List</a>
    </div>
}
else
{
    <div class="mb-3">
        <a asp-action="Index" class="btn btn-secondary">Back</a>
    </div>
}

<hr />

<h4>Volunteers</h4>

@if (Model.Volunteers != null && Model.Volunteers.Any())
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var v in Model.Volunteers)
            {
                <tr>
                    <td>@v.User.UserName</td>
                    <td>@v.User.Email</td>
                    <td>
                        <a asp-controller="Users"
                           asp-action="UserTasks"
                           asp-route-userId="@v.User.UserId"
                           asp-route-eventId="@Model.EventId"
                           class="btn btn-sm btn-outline-primary">
                            View Tasks
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No volunteers yet.</p>
}
